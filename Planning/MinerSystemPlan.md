# Miner System Plan

## Overview

Miners are helpful allies that players can purchase and equip to enhance their mining experience. Each miner provides bonuses to:
- **Coin Earnings**: Increases coins earned from selling ores
- **Ore Luck**: Improves the chance of finding better ores
- **Mining Damage**: Increases damage dealt to mining blocks

The miner system is similar to the pickaxe shop - players can purchase miners with coins and equip one at a time. The equipped miner's bonuses apply to all mining activities.

## Core Concepts

### Miner Rarity Tiers
Miners are organized into 6 rarity tiers:
1. **Common** (5 miners)
2. **Rare** (4 miners)
3. **Epic** (4 miners)
4. **Legendary** (4 miners)
5. **Mythic** (4 miners)
6. **Exotic** (3 miners)

**Total**: 24 miners

### Miner Stats
Each miner has three bonus stats:
- **Coin Bonus**: Percentage increase to coin earnings from selling ores
- **Ore Luck Bonus**: Percentage increase to ore luck (affects ore spawn rates)
- **Damage Bonus**: Percentage increase to mining damage

### Purchase & Equip System
- Miners are purchased with **coins** (earned from mining ores)
- Only one miner can be equipped at a time
- Players start with no miner equipped (base stats)
- Equipped miner bonuses stack with other bonuses (pickaxe, upgrades, etc.)

## Miner Database

### Common Miners

#### Novice Miner
- **Cost**: 250 Coins
- **Coin Bonus**: +15%
- **Ore Luck Bonus**: +5%
- **Damage Bonus**: +10%
- **Rarity**: Common
- **Tier**: 0

#### Coal Miner
- **Cost**: 7,500 Coins (7.5K)
- **Coin Bonus**: +25%
- **Ore Luck Bonus**: +10%
- **Damage Bonus**: +20%
- **Rarity**: Common
- **Tier**: 1

#### Stone Prospector
- **Cost**: 500,000 Coins (500K)
- **Coin Bonus**: +45%
- **Ore Luck Bonus**: +15%
- **Damage Bonus**: +40%
- **Rarity**: Common
- **Tier**: 2

#### Iron Digger
- **Cost**: 15,000,000 Coins (15M)
- **Coin Bonus**: +65%
- **Ore Luck Bonus**: +20%
- **Damage Bonus**: +70%
- **Rarity**: Common
- **Tier**: 3

#### Deep Miner
- **Cost**: 250,000,000 Coins (250M)
- **Coin Bonus**: +90%
- **Ore Luck Bonus**: +25%
- **Damage Bonus**: +100%
- **Rarity**: Common
- **Tier**: 4

### Rare Miners

#### Gold Seeker
- **Cost**: 30,000,000,000 Coins (30B)
- **Coin Bonus**: +130%
- **Ore Luck Bonus**: +30%
- **Damage Bonus**: +130%
- **Rarity**: Rare
- **Tier**: 5

#### Gem Hunter
- **Cost**: 5,000,000,000,000 Coins (5T)
- **Coin Bonus**: +160%
- **Ore Luck Bonus**: +40%
- **Damage Bonus**: +160%
- **Rarity**: Rare
- **Tier**: 6

#### Crystal Prospector
- **Cost**: 200,000,000,000,000 Coins (200T)
- **Coin Bonus**: +200%
- **Ore Luck Bonus**: +50%
- **Damage Bonus**: +200%
- **Rarity**: Rare
- **Tier**: 7

#### Ore Expert
- **Cost**: 20,000,000,000,000,000 Coins (20Qd)
- **Coin Bonus**: +300%
- **Ore Luck Bonus**: +60%
- **Damage Bonus**: +250%
- **Rarity**: Rare
- **Tier**: 8

### Epic Miners

#### Elite Miner
- **Cost**: 2,500,000,000,000,000,000 Coins (2.5Qn)
- **Coin Bonus**: +400%
- **Ore Luck Bonus**: +70%
- **Damage Bonus**: +300%
- **Rarity**: Epic
- **Tier**: 9

#### Master Digger
- **Cost**: 150,000,000,000,000,000,000 Coins (150Qn)
- **Coin Bonus**: +500%
- **Ore Luck Bonus**: +100%
- **Damage Bonus**: +400%
- **Rarity**: Epic
- **Tier**: 10

#### Diamond Specialist
- **Cost**: 5,000,000,000,000,000,000,000 Coins (5Sx)
- **Coin Bonus**: +600%
- **Ore Luck Bonus**: +120%
- **Damage Bonus**: +500%
- **Rarity**: Epic
- **Tier**: 11

#### Tunnel Master
- **Cost**: 5,000,000,000,000,000,000,000,000 Coins (5Sp)
- **Coin Bonus**: +800%
- **Ore Luck Bonus**: +140%
- **Damage Bonus**: +750%
- **Rarity**: Epic
- **Tier**: 12

### Legendary Miners

#### Mining Legend
- **Cost**: 30,000,000,000,000,000,000,000 Coins (30Sp)
- **Coin Bonus**: +1,000%
- **Ore Luck Bonus**: +160%
- **Damage Bonus**: +1,000%
- **Rarity**: Legendary
- **Tier**: 13

#### Deep Dweller
- **Cost**: 1,000,000,000,000,000,000,000,000,000 Coins (1Oc)
- **Coin Bonus**: +1,250%
- **Ore Luck Bonus**: +180%
- **Damage Bonus**: +1,250%
- **Rarity**: Legendary
- **Tier**: 14

#### Underground King
- **Cost**: 125,000,000,000,000,000,000,000,000 Coins (125Oc)
- **Coin Bonus**: +1,500%
- **Ore Luck Bonus**: +200%
- **Damage Bonus**: +1,500%
- **Rarity**: Legendary
- **Tier**: 15

#### Ancient Prospector
- **Cost**: 5,000,000,000,000,000,000,000,000,000 Coins (5No)
- **Coin Bonus**: +2,000%
- **Ore Luck Bonus**: +220%
- **Damage Bonus**: +2,000%
- **Rarity**: Legendary
- **Tier**: 16

### Mythic Miners

#### Molten Core Walker
- **Cost**: 250,000,000,000,000,000,000,000,000 Coins (250No)
- **Coin Bonus**: +2,500%
- **Ore Luck Bonus**: +240%
- **Damage Bonus**: +2,500%
- **Rarity**: Mythic
- **Tier**: 17

#### Earth Shaker
- **Cost**: 100,000,000,000,000,000,000,000,000,000 Coins (100De)
- **Coin Bonus**: +3,000%
- **Ore Luck Bonus**: +260%
- **Damage Bonus**: +3,000%
- **Rarity**: Mythic
- **Tier**: 18

#### Crystal Guardian
- **Cost**: 5,000,000,000,000,000,000,000,000,000,000 Coins (5UDe)
- **Coin Bonus**: +3,500%
- **Ore Luck Bonus**: +280%
- **Damage Bonus**: +3,500%
- **Rarity**: Mythic
- **Tier**: 19

#### Mine Lord
- **Cost**: 250,000,000,000,000,000,000,000,000,000 Coins (250UDe)
- **Coin Bonus**: +4,000%
- **Ore Luck Bonus**: +300%
- **Damage Bonus**: +4,000%
- **Rarity**: Mythic
- **Tier**: 20

### Exotic Miners

#### Depth Strider
- **Cost**: 25,000,000,000,000,000,000,000,000,000,000 Coins (25DDe)
- **Coin Bonus**: +4,500%
- **Ore Luck Bonus**: +320%
- **Damage Bonus**: +4,500%
- **Rarity**: Exotic
- **Tier**: 21

#### Master of Depths
- **Cost**: 2,500,000,000,000,000,000,000,000,000,000,000 Coins (2.5TDe)
- **Coin Bonus**: +5,000%
- **Ore Luck Bonus**: +340%
- **Damage Bonus**: +5,000%
- **Rarity**: Exotic
- **Tier**: 22

#### Eternal Miner
- **Cost**: 375,000,000,000,000,000,000,000,000,000,000 Coins (375TDe)
- **Coin Bonus**: +5,500%
- **Ore Luck Bonus**: +360%
- **Damage Bonus**: +5,500%
- **Rarity**: Exotic
- **Tier**: 23

## UI Design

### Miner Shop Button
- **Location**: Side UI panel (similar to pickaxe shop button)
- **Icon**: Miner icon or "Miners" text button
- **Behavior**: Opens/closes miner shop modal

### Miner Shop Modal
- **Layout**: Similar to pickaxe shop modal
  - Left panel: Selected miner details
  - Right panel: Grid of all miners
- **Miner Cards**: Display in grid format
  - Miner name
  - Miner icon/avatar
  - Cost (formatted number)
  - Availability status:
    - "Owned" (grayed out if not equipped)
    - "Equipped" (highlighted)
    - "Available" (can purchase)
    - "Locked" (can't afford yet)
  - Rarity color coding (Common, Rare, Epic, Legendary, Mythic, Exotic)

### Selected Miner Details Panel
- Miner name and rarity
- Large miner icon/avatar
- Stats display:
  - Coin Bonus: +X%
  - Ore Luck Bonus: +X%
  - Damage Bonus: +X%
- Cost (if not owned)
- Action button:
  - "Equip" (if owned but not equipped)
  - "Equipped" (if currently equipped)
  - "Buy" (if not owned, shows cost)

### UI States
- **No Miner Equipped**: Base stats (0% bonuses)
- **Miner Equipped**: Show equipped miner's bonuses in stats UI
- **Available for Purchase**: Button enabled, shows cost
- **Cannot Afford**: Button disabled, shows cost

## Data Structure

### MinerData Interface
```typescript
interface MinerData {
  tier: number;                    // 0-23 (unique identifier)
  name: string;                    // "Novice Miner", "Coal Miner", etc.
  cost: number;                    // Purchase cost in coins
  coinBonus: number;               // Percentage bonus (e.g., 15 = +15%)
  oreLuckBonus: number;            // Percentage bonus (e.g., 5 = +5%)
  damageBonus: number;             // Percentage bonus (e.g., 10 = +10%)
  rarity: 'Common' | 'Rare' | 'Epic' | 'Legendary' | 'Mythic' | 'Exotic';
  icon?: string;                   // Optional: path to miner icon/avatar
}
```

### PlayerData Extension
```typescript
// Add to existing PlayerData interface:
currentMinerTier: number;          // Currently equipped miner tier (-1 = none)
ownedMiners: number[];             // Array of owned miner tiers [0, 1, 2, ...]
```

## Integration with Existing Systems

### Selling System Integration
- Miner coin bonus applies to `SellingSystem` sell operations
- Formula: `finalSellValue = baseSellValue × (1 + minerCoinBonus / 100)`
- Stacks with:
  - Pickaxe `sellValueMultiplier`
  - Gem Trader "More Coins" upgrade multiplier
- Final formula: `finalSellValue = baseSellValue × pickaxeMultiplier × moreCoinsMultiplier × (1 + minerCoinBonus / 100)`

### Ore Generation Integration
- Miner ore luck bonus applies to ore spawn probability
- Formula: `finalLuck = baseLuck + pickaxeLuck + minerOreLuckBonus`
- Used in `OreGenerator` when determining ore spawns

### Mining Damage Integration
- Miner damage bonus applies to mining damage calculations
- Formula: `finalDamage = baseDamage × (1 + minerDamageBonus / 100)`
- Applied in `MiningSystem` after base damage calculation
- Stacks with:
  - Gem Trader "More Damage" upgrade multiplier
- Final formula: `finalDamage = baseDamage × moreDamageMultiplier × (1 + minerDamageBonus / 100)`

## Implementation Components

### MinerData.ts
- Define `MinerData` interface
- Create `MINER_DATABASE` array with all 24 miners
- Export miner lookup functions

### MinerShop.ts
- Handle miner purchase logic
- Manage owned miners list
- Handle equip/unequip logic
- Validate purchases (enough coins, not already owned)

### MinerManager.ts
- Manages current equipped miner per player
- Provides getter methods for miner bonuses
- Integrates with GameManager

### UI Components (index.html)
- Miner shop button in side panel
- Miner shop modal (similar to pickaxe modal)
- Miner grid display
- Selected miner details panel
- Purchase/equip button handlers

## Purchase Flow

1. Player clicks miner shop button → Opens miner modal
2. Player views available miners in grid
3. Player clicks on a miner card → Shows details in left panel
4. If miner is not owned:
   - Shows "Buy" button with cost
   - If player has enough coins: Button enabled
   - If player doesn't have enough coins: Button disabled
5. Player clicks "Buy" → Deducts coins, adds miner to owned list
6. After purchase, miner becomes available to equip
7. If miner is owned but not equipped:
   - Shows "Equip" button
8. Player clicks "Equip" → Sets `currentMinerTier`, applies bonuses
9. If miner is already equipped:
   - Shows "Equipped" label (button disabled)

## Bonus Calculation Formulas

### Coin Bonus Calculation
```typescript
function calculateFinalSellValue(
  baseValue: number,
  pickaxeMultiplier: number,
  moreCoinsMultiplier: number,
  minerCoinBonus: number
): number {
  return baseValue * pickaxeMultiplier * moreCoinsMultiplier * (1 + minerCoinBonus / 100);
}
```

### Ore Luck Calculation
```typescript
function calculateFinalOreLuck(
  pickaxeLuck: number,
  minerOreLuckBonus: number
): number {
  return pickaxeLuck + minerOreLuckBonus;
}
```

### Damage Bonus Calculation
```typescript
function calculateFinalDamage(
  baseDamage: number,
  moreDamageMultiplier: number,
  minerDamageBonus: number
): number {
  return baseDamage * moreDamageMultiplier * (1 + minerDamageBonus / 100);
}
```

## Persistence

### Save Data
- `currentMinerTier`: Save equipped miner tier
- `ownedMiners`: Save array of owned miner tiers
- Persist in player data file alongside pickaxes, upgrades, etc.

### Load Data
- On player join, restore equipped miner
- Restore owned miners list
- Apply miner bonuses immediately after load

## UI Events

### Client → Server
- `OPEN_MINER_SHOP`: Open miner shop modal
- `CLOSE_MINER_SHOP`: Close miner shop modal
- `PURCHASE_MINER`: Purchase a miner (tier)
- `EQUIP_MINER`: Equip a miner (tier)
- `UNEQUIP_MINER`: Unequip current miner

### Server → Client
- `MINER_SHOP_UPDATE`: Send miner shop data
  - All miners with availability status
  - Current equipped miner tier
  - Player's gold
- `MINER_EQUIPPED`: Notify miner was equipped
- `MINER_PURCHASED`: Notify miner was purchased

## Implementation Checklist

### Backend
- [ ] Create `MinerData.ts` with miner database
- [ ] Create `MinerShop.ts` for purchase/equip logic
- [ ] Create `MinerManager.ts` for miner state management
- [ ] Extend `PlayerData` interface with miner fields
- [ ] Update `PersistenceManager` to save/load miner data
- [ ] Integrate coin bonus into `SellingSystem`
- [ ] Integrate ore luck bonus into `OreGenerator`
- [ ] Integrate damage bonus into `MiningSystem`
- [ ] Add miner shop UI event handlers in `index.ts`

### Frontend
- [ ] Add miner shop button to side UI panel
- [ ] Create miner shop modal HTML structure
- [ ] Style miner cards with rarity colors
- [ ] Implement miner grid display
- [ ] Implement selected miner details panel
- [ ] Add purchase/equip button handlers
- [ ] Format miner costs using `formatNumber` function
- [ ] Add miner shop UI event handlers
- [ ] Update HUD to show equipped miner (optional)

### Testing
- [ ] Test miner purchase flow
- [ ] Test miner equip/unequip flow
- [ ] Test coin bonus stacking with pickaxe and upgrades
- [ ] Test ore luck bonus stacking
- [ ] Test damage bonus stacking with upgrades
- [ ] Test persistence (save/load)
- [ ] Test UI state management

## Future Enhancements (Optional)

- Miner cosmetics/avatars
- Miner animations
- Miner-specific abilities
- Miner prestige system
- Miner achievements
- Miner collection bonuses

